# workaround

image: concourse/concourse
imageTag: "5.8.1"

secrets:
  localUsers: admin:admin,guest:guest

web:
  replicas: 2
  localAuth:
    enabled: true
  additionalVolumes:
    - name: dsdsocket
      hostPath:
        path: /var/run/datadog
  additionalVolumeMounts:
    - name: dsdsocket
      mountPath: /var/run/datadog
  resources:
    requests:
      cpu: "1000m"
      memory: "1Gi"
    limits:
      cpu: "1000m"
      memory: "1Gi"

worker:
  replicas: 10
  hardAntiAffinity: true

concourse:
  web:
    auth:
      mainTeam:
        localUser: admin
    metrics:
      attribute: "environment:workaround"
    datadog:
      enabled: true
      agentHost: unix
      agentPort: ///var/run/datadog/dsd.socket
      prefix: "concourse.workaround"
    # externalUrl: https://workaround.concourse-ci.org
    containerPlacementStrategy: fewest-build-containers
  worker:
    baggageclaim:
      driver: overlay
datadog:
  datadog:
    useDogStatsDSocketVolume: true
    apiKey: DATADOG_API_KEY
    appKey: DATADOG_APP_KEY
    processAgentEnabled: true
    tags:
      - "env:workaround"
    kubeStateMetrics:
      enabled: false


postgresql:
  resources:
    requests:
      cpu: 1000m
      memory: 2Gi
    limits:
      cpu: 1000m
      memory: 2Gi
  postgresqlConfiguration: {"sharedPreloadLibraries": "'pg_stat_statements'", "listenAddresses": "'*'"}
  postgresqlUsername: "concourse"
  postgresqlPassword: "concourse"
  postgresqlPostgresPassword: A_PASSWORD
  persistence:
    size: 64Gi
  shmVolume:
    enabled: true
